---
description: Build the codebase based on the plan with full quality assurance
argument-hint: [path-to-plan]
---

# Build

Follow the `Workflow` to implement the `PATH_TO_PLAN` with comprehensive quality gates, then `Report` the completed work.

## Variables

PATH_TO_PLAN: $ARGUMENTS

## Workflow

### Phase 1: Planning & Implementation

1. **Validate Input**
   - If no `PATH_TO_PLAN` is provided, STOP immediately and ask the user to provide it.
   - Read the plan at `PATH_TO_PLAN`
   - Create a TodoList with all implementation tasks from the spec

2. **Implementation**
   - Implement the code following the specification
   - Update TodoList as you complete each task
   - Run linting: `uv run ruff check` on changed files
   - Fix any linting errors before proceeding

3. **Verify Existing Tests**
   - Run all existing tests: `just test`
   - If any tests fail, fix them before proceeding
   - All existing tests MUST pass before quality gates

### Phase 2: Quality Gates (MANDATORY)

**CRITICAL**: You MUST run ALL three quality gate agents in parallel. Do NOT skip this step.

4. **Run Quality Gate Agents** (Use Task tool with THREE parallel calls in a SINGLE message)
   - Launch `security-auditor` agent to audit all changed files
   - Launch `code-guardian` agent to review code quality
   - Launch `test-sentinel` agent to generate comprehensive test suite

5. **Review Agent Reports**
   - Read all three agent reports carefully
   - Address any CRITICAL or HIGH severity findings immediately
   - For MEDIUM findings, document them for follow-up
   - Ensure test coverage is comprehensive (aim for >80%)

6. **Implement Fixes**
   - Fix all critical security vulnerabilities found by security-auditor
   - Address all critical code quality issues found by code-guardian
   - Implement all tests generated by test-sentinel
   - Run tests again: `just test`
   - All tests MUST pass (including new tests)

### Phase 3: Final Verification

7. **Final Checks**
   - Run linting one more time: `uv run ruff check .`
   - Run full test suite: `just test`
   - Verify test count increased (report old vs new count)
   - Run `git diff --stat` to see all changes

8. **Documentation**
   - Update ROADMAP.md if completing a phase
   - Update CLAUDE.md if adding new patterns/conventions
   - Commit message should reference the spec file

## Report

Generate a comprehensive report with the following sections:

### Implementation Summary
- List of features implemented (bullet points)
- Key technical decisions made
- Any deviations from the spec (with rationale)

### Files Changed
```
git diff --stat
```

### Quality Gates Results
- **Security Audit**: X findings (0 Critical, X High, X Medium, X Low)
  - List any critical findings that were fixed
  - Document any accepted risks
- **Code Review**: Code quality score and key recommendations
  - List any critical issues that were fixed
- **Test Coverage**: X new tests added (old count â†’ new count)
  - Test pass rate: X/X (100%)

### Next Steps
- Any remaining MEDIUM findings to address
- Suggestions for follow-up work
- Related phases to consider

## Quality Gate Checklist

Before marking build as complete, verify:

- [ ] All code implemented per spec
- [ ] Linting passes (`uv run ruff check .`)
- [ ] All existing tests still pass
- [ ] Security audit completed (security-auditor agent)
- [ ] Code review completed (code-guardian agent)
- [ ] New tests generated and passing (test-sentinel agent)
- [ ] Test count increased appropriately
- [ ] All CRITICAL/HIGH findings addressed
- [ ] Documentation updated (ROADMAP.md, CLAUDE.md)
- [ ] Git diff reviewed and makes sense

## Example Usage

```bash
# Good: Specify the plan file
/build specs/phase-7-individual-stock-scanning.md

# Bad: No plan file
/build  # This will stop and ask for the plan
```

## Notes

- **DO NOT SKIP QUALITY GATES**: The three agents (security-auditor, code-guardian, test-sentinel) MUST be run in parallel after implementation
- **FIX CRITICAL FINDINGS**: Any Critical or High severity findings MUST be addressed before completing the build
- **TEST COVERAGE**: New tests are not optional - they are required for every build
- **PARALLEL EXECUTION**: Run all three quality gate agents in a SINGLE message for efficiency